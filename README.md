# micro-cardservice

Credit card and customer microservice built with Quarkus.
This project exposes endpoints for customer registration, card creation,
purchase registration, and invoice retrieval/payment.

## Stack
- Java 17
- Quarkus 3.3.1
- Hibernate ORM + Panache
- H2 (in-memory)
- MapStruct
- Maven

## Requirements
- Java 17+
- Maven (or use the repo Maven Wrapper)

## Run (dev)
```bash
./mvnw quarkus:dev
```
On Windows:
```bat
mvnw.cmd quarkus:dev
```

By default the API runs at:
```
http://localhost:8080
```

## Endpoints (main)

### Customers
- `GET /clientes`  
  Returns 200 with a list or 204 when empty.

- `POST /clientes`  
  Body (JSON):
```json
{
  "name": "Joao da Silva",
  "cpf": "12345678900",
  "email": "joao@email.com",
  "phoneNumber": "11999999999"
}
```

### Cards
- `POST /cartoes`  
  Body (JSON) expected by the use case:
```json
{
  "bandeira": "Mastercard",
  "nomeTitular": "Joao da Silva",
  "cvv": "123",
  "clienteId": "11111111-1111-1111-1111-111111111111"
}
```
Card number, expiry date, and limits are generated by the service.

### Transactions (purchases)
- `POST /transacoes`  
  Body (JSON):
```json
{
  "descricao": "Purchase at the market",
  "valor": 100.00,
  "dataHora": "2024-01-15T10:30:00",
  "cartaoId": "22222222-2222-2222-2222-222222222222"
}
```

### Invoice
- `GET /fatura/{ano}/{mes}`  
  Example: `/fatura/2024/01`

- `POST /fatura/transacao`  
  Body (JSON) is the same as transaction.

- `POST /fatura/pagar/{ano}/{mes}`  
  Marks the invoice as paid.

## Tests
```bash
./mvnw test
```

## Configuration
Main settings live in:
- `src/main/resources/application.properties`
- `src/test/resources/application.properties`

The database is H2 in-memory with `drop-and-create`.
